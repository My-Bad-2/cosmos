#ifndef CPU_REGISTERS_H
#define CPU_REGISTERS_H

#define INTERRUPT_STACK_SIZE (4096)
#define PERCPU_INTERRUPT_STACKS_NMI_OFFSET 0x20E0

#define IFRAME_OFFSET_RDI (0 * 8)
#define IFRAME_OFFSET_RSI (1 * 8)
#define IFRAME_OFFSET_RBP (2 * 8)
#define IFRAME_OFFSET_RBX (3 * 8)
#define IFRAME_OFFSET_RDX (4 * 8)
#define IFRAME_OFFSET_RCX (5 * 8)
#define IFRAME_OFFSET_RAX (6 * 8)
#define IFRAME_OFFSET_R8 (7 * 8)
#define IFRAME_OFFSET_R9 (8 * 8)
#define IFRAME_OFFSET_R10 (9 * 8)
#define IFRAME_OFFSET_R11 (10 * 8)
#define IFRAME_OFFSET_R12 (11 * 8)
#define IFRAME_OFFSET_R13 (12 * 8)
#define IFRAME_OFFSET_R14 (13 * 8)
#define IFRAME_OFFSET_R15 (14 * 8)

#define IFRAME_OFFSET_VECTOR (15 * 8)
#define IFRAME_OFFSET_ERR_CODE (16 * 8)

#define IFRAME_OFFSET_IP (17 * 8)
#define IFRAME_OFFSET_CS (18 * 8)
#define IFRAME_OFFSET_FLAGS (19 * 8)
#define IFRAME_OFFSET_USER_SP (20 * 8)
#define IFRAME_OFFSET_USER_SS (21 * 8)

#define IFRAME_SIZE (22 * 8)

#define MSR_IA32_EFER 0xc0000080
#define MSR_IA32_STAR 0xc0000081
#define MSR_IA32_LSTAR 0xc0000082
#define MSR_IA32_CSTAR 0xc0000083
#define MSR_IA32_FMASK 0xc0000084
#define MSR_IA32_FS_BASE 0xc0000100
#define MSR_IA32_GS_BASE 0xc0000101
#define MSR_IA32_KERNEL_GS_BASE 0xc0000102
#define MSR_IA32_TSC_AUX 0xc0000103
#define MSR_IA32_PM_ENABLE 0x00000770
#define MSR_IA32_HWP_CAPABILITIES 0x00000771
#define MSR_IA32_HWP_REQUEST 0x00000774
#define MSR_AMD_VIRT_SPEC_CTRL 0xc001011f

#define MSR_IA32_PLATFORM_ID 0x00000017
#define MSR_IA32_APIC_BASE 0x0000001b
#define MSR_IA32_TSC_ADJUST 0x0000003b
#define MSR_IA32_SPEC_CTRL 0x00000048

#define MSR_SMI_COUNT 0x00000034
#define MSR_IA32_PRED_CMD 0x00000049
#define MSR_IA32_BIOS_UPDT_TRIG 0x00000079u
#define MSR_IA32_BIOS_SIGN_ID 0x0000008b
#define MSR_IA32_MTRRCAP 0x000000fe
#define MSR_IA32_ARCH_CAPABILITIES 0x0000010a

#define MSR_IA32_FLUSH_CMD 0x0000010b
#define MSR_IA32_TSX_CTRL 0x00000122
#define MSR_IA32_SYSENTER_CS 0x00000174
#define MSR_IA32_SYSENTER_ESP 0x00000175
#define MSR_IA32_SYSENTER_EIP 0x00000176
#define MSR_IA32_MCG_CAP 0x00000179
#define MSR_IA32_MCG_STATUS 0x0000017a
#define MSR_IA32_MISC_ENABLE 0x000001a0
#define MSR_IA32_TEMPERATURE_TARGET 0x000001a2
#define MSR_IA32_ENERGY_PERF_BIAS 0x000001b0
#define MSR_IA32_MTRR_PHYSBASE0 0x00000200
#define MSR_IA32_MTRR_PHYSMASK0 0x00000201
#define MSR_IA32_MTRR_PHYSMASK9 0x00000213
#define MSR_IA32_MTRR_DEF_TYPE 0x000002ff
#define MSR_IA32_MTRR_FIX64K_00000 0x00000250
#define MSR_IA32_MTRR_FIX16K_80000 0x00000258
#define MSR_IA32_MTRR_FIX16K_A0000 0x00000259
#define MSR_IA32_MTRR_FIX4K_C0000 0x00000268
#define MSR_IA32_MTRR_FIX4K_F8000 0x0000026f
#define MSR_IA32_PAT 0x00000277
#define MSR_IA32_TSC_DEADLINE 0x000006e0

#ifndef __ASSEMBLER__

#include <stdint.h>

struct iframe {
	uint64_t rdi, rsi, rbp, rbx, rdx, rcx, rax;
	uint64_t r8, r9, r10, r11, r12, r13, r14, r15;
	uint64_t vector;
	uint64_t err_code;
	uint64_t ip, cs, flags;
	uint64_t user_sp, user_ss;
};

#endif	// __ASSEMBLER__

#endif	// CPU_REGISTERS_H